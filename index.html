<!DOCTYPE html>
<html lang="es">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- AQUI AJUSTAS el TÃ­tulo de la aplicaciÃ³n para que se muestre en el navegador -->
  <title>app rr</title>

  <!-- Aquí­ traes el CSS de la librerÃ­a Leaflet para mapas interactivos -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <!-- Aquí­ traers tu archivo de estilos personalizados de la aplicaciÃ³n -->
  <link rel="stylesheet" href="style.css">

</head>

<body>

  <div class="header">
    <h1>Probando SIG</h1>
  </div>

  <div class="main-container">
    
    <!-- Botones pequeños -->
    <div class="tab-buttons">
      <button onclick="openTab('tab1')">1</button>
      <button onclick="openTab('tab2')">2</button>
    </div>
    

<!-- Sidebar dinámico -->
    <div class="sidebar-layers">
    
    <div class="filter-section CITY">
      <button data-city="Valparaiso">Valparaiso</button>
      <button data-city="Temuco">Temuco</button>
      <button data-city="Valdivia">Valdivia</button>
    </div>
      
      <!-- Sidebar TAB 1 -->
      <div id="sidebar-tab1" class="sidebar-content active">
        
        <h3>Filtros</h3>
        <div class="filter-section">
          <label>Selecciona categorías:</label><br>
          <input type="checkbox" name="categoria" value="a" checked id="cat-a"><label for="cat-a"> A</label><br>
          <input type="checkbox" name="categoria" value="b" checked id="cat-b"><label for="cat-b"> B</label><br>
          <input type="checkbox" name="categoria" value="c" checked id="cat-c"><label for="cat-c"> C</label><br>
          <input type="checkbox" name="categoria" value="d" id="cat-d"><label for="cat-d"> D</label>
        </div>

        <div class="filter-section">
          <label for="campoSelect">Filtrar por campo:</label>
          <select id="campoSelect">
            <option value="Value" selected>Valor</option>
            <option value="ID">ID</option>
          </select>
        </div>

        <div class="filter-section">
          <label for="valorRange">Valor mínimo: <span id="valorLabel">0</span></label>
          <div class="range-container">
            <input type="range" id="valorRange" min="0" max="100" step="1" value="0">
          </div>
        </div>
      </div>

      <!-- Sidebar TAB 2 -->
      <div id="sidebar-tab2" class="sidebar-content">
        <h3>Opciones Tab 2</h3>
        <p>Aquí puedes poner filtros distintos, o configuraciones especiales.</p>
      </div>      
      
      <div class="coordinates-display" id="coordinates">
        Lat: 0.000000, Lng: 0.000000
      </div>
    </div>
    
    <div id="map"></div>
  </div>

 

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  
  <script>
  
    function openTab(tabId) {
      // Ocultar todos los sidebars
      document.querySelectorAll(".sidebar-content").forEach(s => s.classList.remove("active"));
      // Mostrar el sidebar de la pestaña seleccionada
      document.getElementById("sidebar-" + tabId).classList.add("active");

      // Resaltar el botón activo
      document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active-btn"));
      event.currentTarget.classList.add("active-btn");
    }
  
    const ciudadCentro = {
      "Valparaiso": { lat: -33.0458, lng: -71.6197, zoom: 12 },
      "Temuco": { lat: -38.7359, lng: -72.5904, zoom: 12 },
      "Valdivia": { lat: -39.8196, lng: -73.2451, zoom: 12 }
    };
  
    const map = L.map('map').setView([-36.4569, -71.4], 6);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      maxZoom: 19
    }).addTo(map);
    
    let ciudadSeleccionada = null; // ninguna ciudad seleccionada al inicio
    let dataGeoJSON;
    let geojsonLayer;

    const campoSelect = document.getElementById("campoSelect");

    function getColorByCategory(categoria) {
      switch(categoria) {
        case "a": return "#FF4136";
        case "b": return "#0074D9";
        case "c": return "#2ECC40";
        default: return "#AAAAAA";
      }
    }

    
    function filtrarPuntos() {
      if (!dataGeoJSON) return;

      const campo = campoSelect.value;
      const valorMin = parseInt(document.getElementById("valorRange").value);
      const categorias = Array.from(document.querySelectorAll('input[name="categoria"]:checked')).map(cb => cb.value);

      if (geojsonLayer) map.removeLayer(geojsonLayer);

      geojsonLayer = L.geoJSON(dataGeoJSON, {
        filter: feature => 
        categorias.includes(feature.properties.categoria) &&
        feature.properties[campo] >= valorMin &&
        (!ciudadSeleccionada || feature.properties.Ciudad === ciudadSeleccionada),
        
        pointToLayer: (feature, latlng) => {
          let color = getColorByCategory(feature.properties.categoria);
          return L.circleMarker(latlng, {
            radius: 6,
            fillColor: color,
            color: "#fff",
            weight: 1,
            fillOpacity: 0.9
          }).bindPopup(
            `ID: ${feature.properties.ID}<br>` +
            `Valor: ${feature.properties.Value}<br>` +
            `CategorÃ­a: ${feature.properties.categoria}`
          );
        }
      }).addTo(map);
    }

    // Eventos de filtros
    
    document.querySelectorAll('.CITY button').forEach(btn => {
      btn.addEventListener('click', () => {
        ciudadSeleccionada = btn.dataset.city;
        filtrarPuntos(); // filtra los puntos

        // Hacer zoom al centro de la ciudad
        const centro = ciudadCentro[ciudadSeleccionada];
        if (centro) {
          map.setView([centro.lat, centro.lng], centro.zoom);
        }
      });
    });
    
    document.getElementById("valorRange").addEventListener("input", () => {
      document.getElementById("valorLabel").textContent = document.getElementById("valorRange").value;
      filtrarPuntos();
    });

    document.querySelectorAll('input[name="categoria"]').forEach(cb => cb.addEventListener("change", filtrarPuntos));
    campoSelect.addEventListener("change", filtrarPuntos);

    // Coordenadas en tiempo real
    map.on('mousemove', e => {
      document.getElementById('coordinates').textContent = 
        `Lat: ${e.latlng.lat.toFixed(6)}, Lng: ${e.latlng.lng.toFixed(6)}`;
    });

    // Cargar GeoJSON externo
    fetch('puntos_100_ciudades.geojson')
      .then(resp => resp.json())
      .then(data => {
        dataGeoJSON = data;
        filtrarPuntos(); // Mostrar puntos iniciales
      })
      .catch(err => console.error("Error cargando GeoJSON:", err));
  </script>
</body>
</html>